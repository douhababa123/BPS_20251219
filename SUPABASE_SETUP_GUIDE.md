# Supabaseæ•°æ®åº“é…ç½®æŒ‡å—

## ğŸ“š ç›®å½•
1. [Supabaseç®€ä»‹](#supabaseç®€ä»‹)
2. [åˆ›å»ºSupabaseè´¦æˆ·å’Œé¡¹ç›®](#åˆ›å»ºsupabaseè´¦æˆ·å’Œé¡¹ç›®)
3. [æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡](#æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡)
4. [åˆ›å»ºæ•°æ®è¡¨æ­¥éª¤](#åˆ›å»ºæ•°æ®è¡¨æ­¥éª¤)
5. [é…ç½®è®¿é—®æƒé™](#é…ç½®è®¿é—®æƒé™)
6. [æµ‹è¯•æ•°æ®åº“è¿æ¥](#æµ‹è¯•æ•°æ®åº“è¿æ¥)
7. [åæœŸè¿ç§»åˆ°SQL Server](#åæœŸè¿ç§»åˆ°sql-server)

---

## Supabaseç®€ä»‹

### ä»€ä¹ˆæ˜¯Supabaseï¼Ÿ
Supabaseæ˜¯ä¸€ä¸ªå¼€æºçš„Firebaseæ›¿ä»£å“ï¼Œæä¾›ï¼š
- âœ… PostgreSQLæ•°æ®åº“ï¼ˆéå¸¸å¼ºå¤§çš„å…³ç³»å‹æ•°æ®åº“ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆçš„REST API
- âœ… å®æ—¶è®¢é˜…åŠŸèƒ½
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… æ–‡ä»¶å­˜å‚¨
- âœ… å…è´¹å¥—é¤ï¼ˆé€‚åˆå¼€å‘å’Œæµ‹è¯•ï¼‰

### ä¸ºä»€ä¹ˆé€‰æ‹©Supabaseä½œä¸ºè°ƒè¯•å·¥å…·ï¼Ÿ
- ğŸš€ å¿«é€Ÿæ­å»ºï¼Œæ— éœ€è‡ªå·±ç®¡ç†æœåŠ¡å™¨
- ğŸ’° å…è´¹é¢åº¦å……è¶³ï¼ˆ500MBæ•°æ®åº“ + 1GBæ–‡ä»¶å­˜å‚¨ï¼‰
- ğŸ”§ å¯è§†åŒ–ç•Œé¢ï¼Œæ˜“äºæ“ä½œ
- ğŸ“Š å†…ç½®SQLç¼–è¾‘å™¨
- ğŸ”„ åç»­å¯è½»æ¾å¯¼å‡ºæ•°æ®è¿ç§»åˆ°SQL Server

---

## åˆ›å»ºSupabaseè´¦æˆ·å’Œé¡¹ç›®

### æ­¥éª¤1ï¼šæ³¨å†ŒSupabaseè´¦æˆ·

1. **è®¿é—®Supabaseå®˜ç½‘**
   - æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://supabase.com
   
2. **ç‚¹å‡»"Start your project"æŒ‰é’®**
   - ä½äºé¦–é¡µå³ä¸Šè§’

3. **é€‰æ‹©æ³¨å†Œæ–¹å¼**
   - æ¨èä½¿ç”¨ **GitHubè´¦æˆ·** ç™»å½•ï¼ˆæœ€å¿«ï¼‰
   - æˆ–ä½¿ç”¨ **é‚®ç®±** æ³¨å†Œ
   
4. **éªŒè¯é‚®ç®±**ï¼ˆå¦‚æœä½¿ç”¨é‚®ç®±æ³¨å†Œï¼‰
   - æ£€æŸ¥æ”¶ä»¶ç®±ï¼Œç‚¹å‡»éªŒè¯é“¾æ¥

### æ­¥éª¤2ï¼šåˆ›å»ºæ–°é¡¹ç›®

1. **è¿›å…¥Dashboard**
   - ç™»å½•åä¼šè‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨ç›˜

2. **ç‚¹å‡»"New Project"æŒ‰é’®**
   - ä½äºå·¦ä¾§è¾¹æ æˆ–ä¸­é—´çš„ç©ºç™½åŒºåŸŸ

3. **é€‰æ‹©Organization**
   - å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œéœ€è¦å…ˆåˆ›å»ºOrganization
   - ç‚¹å‡»"New organization"
   - è¾“å…¥åç§°ï¼Œä¾‹å¦‚ï¼š`BPS-Development`

4. **å¡«å†™é¡¹ç›®ä¿¡æ¯**
   ```
   Project Name: BPS-Competency-System
   Database Password: [è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ŒåŠ¡å¿…ä¿å­˜å¥½ï¼]
   Region: Northeast Asia (Seoul) [é€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„åŒºåŸŸ]
   Pricing Plan: Free [å…è´¹å¥—é¤]
   ```

5. **ç‚¹å‡»"Create new project"**
   - ç­‰å¾…1-2åˆ†é’Ÿï¼ŒSupabaseä¼šè‡ªåŠ¨é…ç½®æ•°æ®åº“

6. **é¡¹ç›®åˆ›å»ºæˆåŠŸ**
   - æ‚¨ä¼šçœ‹åˆ°é¡¹ç›®ä»ªè¡¨ç›˜ï¼ŒåŒ…å«API URLã€å¯†é’¥ç­‰ä¿¡æ¯

---

## æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

### è¡¨1ï¼šèƒ½åŠ›å®šä¹‰è¡¨ (competency_definitions)

**ç”¨é€”**ï¼šå­˜å‚¨9å¤§èƒ½åŠ›æ¨¡å—å’Œ39ç§èƒ½åŠ›ç±»å‹çš„å®šä¹‰

**è¡¨ç»“æ„è®¾è®¡**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|--------|---------|------|------|
| `id` | `bigint` | ä¸»é”®ID | PRIMARY KEY, AUTO INCREMENT |
| `module_id` | `integer` | èƒ½åŠ›æ¨¡å—ID (1-9) | NOT NULL |
| `module_name` | `text` | èƒ½åŠ›æ¨¡å—åç§° | NOT NULL |
| `competency_type` | `text` | èƒ½åŠ›ç±»å‹åç§° | NOT NULL |
| `competency_code` | `varchar(50)` | èƒ½åŠ›ç¼–ç  | UNIQUE |
| `description` | `text` | èƒ½åŠ›æè¿° | NULL |
| `owner_engineer` | `text` | è´Ÿè´£å·¥ç¨‹å¸ˆ | NULL |
| `is_key_competency` | `boolean` | æ˜¯å¦å…³é”®èƒ½åŠ› | DEFAULT false |
| `created_at` | `timestamptz` | åˆ›å»ºæ—¶é—´ | DEFAULT now() |
| `updated_at` | `timestamptz` | æ›´æ–°æ—¶é—´ | DEFAULT now() |

**9å¤§èƒ½åŠ›æ¨¡å—å‚è€ƒ**ï¼š
1. BPS elements - BPSåŸºç¡€å…ƒç´ 
2. Investment efficiency - æŠ•èµ„æ•ˆç‡
3. Team Competence Elements - å›¢é˜Ÿèƒ½åŠ›è¦ç´ 
4. TPM (Total Productive Maintenance) - å…¨é¢ç”Ÿäº§ç»´æŠ¤
5. IE (Industrial Engineering) - å·¥ä¸šå·¥ç¨‹
6. LRP (Lean Realization Process) - ç²¾ç›Šå®ç°æµç¨‹
7. Everybody's CIP - å…¨å‘˜æŒç»­æ”¹è¿›
8. Leadership commitment - é¢†å¯¼åŠ›æ‰¿è¯º
9. CIP in indirect area / Digital Transformation - é—´æ¥é¢†åŸŸæ”¹è¿›/æ•°å­—åŒ–è½¬å‹

### è¡¨2ï¼šèƒ½åŠ›è¯„ä¼°è¡¨ (competency_assessments)

**ç”¨é€”**ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆçš„èƒ½åŠ›è¯„ä¼°æ•°æ®

**è¡¨ç»“æ„è®¾è®¡**ï¼š

| å­—æ®µå | æ•°æ®ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|--------|---------|------|------|
| `id` | `bigint` | ä¸»é”®ID | PRIMARY KEY, AUTO INCREMENT |
| `engineer_id` | `varchar(50)` | å·¥ç¨‹å¸ˆID | NOT NULL |
| `engineer_name` | `text` | å·¥ç¨‹å¸ˆå§“å | NOT NULL |
| `department` | `text` | éƒ¨é—¨ | NOT NULL |
| `competency_id` | `bigint` | èƒ½åŠ›å®šä¹‰IDï¼ˆå¤–é”®ï¼‰ | FOREIGN KEY â†’ competency_definitions(id) |
| `module_name` | `text` | èƒ½åŠ›æ¨¡å— | NOT NULL |
| `competency_type` | `text` | èƒ½åŠ›ç±»å‹ | NOT NULL |
| `current_score` | `smallint` | ç°çŠ¶å¾—åˆ† (1-5) | NOT NULL, CHECK (current_score >= 1 AND current_score <= 5) |
| `target_score` | `smallint` | ç›®æ ‡å¾—åˆ† (1-5) | NOT NULL, CHECK (target_score >= 1 AND target_score <= 5) |
| `gap` | `smallint` | å·®è·å€¼ | GENERATED ALWAYS AS (target_score - current_score) STORED |
| `assessment_year` | `integer` | è¯„ä¼°å¹´åº¦ | NOT NULL |
| `assessment_date` | `date` | è¯„ä¼°æ—¥æœŸ | DEFAULT now() |
| `notes` | `text` | å¤‡æ³¨ | NULL |
| `created_at` | `timestamptz` | åˆ›å»ºæ—¶é—´ | DEFAULT now() |
| `updated_at` | `timestamptz` | æ›´æ–°æ—¶é—´ | DEFAULT now() |

**å…³é”®çº¦æŸ**ï¼š
- `current_score` å’Œ `target_score` å¿…é¡»åœ¨1-5ä¹‹é—´
- `target_score` å¿…é¡» >= `current_score`ï¼ˆé€šè¿‡è§¦å‘å™¨æˆ–åº”ç”¨å±‚éªŒè¯ï¼‰
- `gap` æ˜¯è®¡ç®—åˆ—ï¼Œè‡ªåŠ¨è®¡ç®— = target_score - current_score

### è¡¨å…³ç³»

```
competency_definitions (1) â†â†’ (N) competency_assessments
              â†‘
              â””â”€â”€ é€šè¿‡ competency_id å…³è”
```

---

## åˆ›å»ºæ•°æ®è¡¨æ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨SQLç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰

#### æ­¥éª¤1ï¼šæ‰“å¼€SQLç¼–è¾‘å™¨

1. åœ¨Supabaseé¡¹ç›®ä»ªè¡¨ç›˜ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **"SQL Editor"**
2. ç‚¹å‡» **"New query"** åˆ›å»ºæ–°æŸ¥è¯¢

#### æ­¥éª¤2ï¼šåˆ›å»ºèƒ½åŠ›å®šä¹‰è¡¨

å¤åˆ¶ä»¥ä¸‹SQLä»£ç åˆ°ç¼–è¾‘å™¨ï¼š

```sql
-- ============================================
-- åˆ›å»ºèƒ½åŠ›å®šä¹‰è¡¨ (competency_definitions)
-- ============================================

CREATE TABLE IF NOT EXISTS public.competency_definitions (
    id BIGSERIAL PRIMARY KEY,
    module_id INTEGER NOT NULL,
    module_name TEXT NOT NULL,
    competency_type TEXT NOT NULL,
    competency_code VARCHAR(50) UNIQUE,
    description TEXT,
    owner_engineer TEXT,
    is_key_competency BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- æ·»åŠ æ³¨é‡Š
COMMENT ON TABLE public.competency_definitions IS 'èƒ½åŠ›å®šä¹‰è¡¨ - å­˜å‚¨9å¤§èƒ½åŠ›æ¨¡å—å’Œ39ç§èƒ½åŠ›ç±»å‹';
COMMENT ON COLUMN public.competency_definitions.module_id IS 'èƒ½åŠ›æ¨¡å—ID (1-9)';
COMMENT ON COLUMN public.competency_definitions.module_name IS 'èƒ½åŠ›æ¨¡å—åç§°ï¼ˆå¦‚ï¼šTPMåŸºç¡€ã€ç²¾ç›Šæµç¨‹ç­‰ï¼‰';
COMMENT ON COLUMN public.competency_definitions.competency_type IS 'èƒ½åŠ›ç±»å‹åç§°';
COMMENT ON COLUMN public.competency_definitions.competency_code IS 'èƒ½åŠ›ç¼–ç ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰';
COMMENT ON COLUMN public.competency_definitions.owner_engineer IS 'è´Ÿè´£è¯¥èƒ½åŠ›çš„å·¥ç¨‹å¸ˆ';

-- åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_competency_definitions_module_id ON public.competency_definitions(module_id);
CREATE INDEX idx_competency_definitions_module_name ON public.competency_definitions(module_name);

-- åˆ›å»ºæ›´æ–°æ—¶é—´çš„è‡ªåŠ¨è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_competency_definitions_updated_at 
    BEFORE UPDATE ON public.competency_definitions 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

**æ“ä½œ**ï¼š
- ç‚¹å‡»å³ä¸‹è§’çš„ **"Run"** æŒ‰é’®ï¼ˆæˆ–æŒ‰ Ctrl+Enterï¼‰
- çœ‹åˆ° "Success. No rows returned" è¡¨ç¤ºåˆ›å»ºæˆåŠŸ

#### æ­¥éª¤3ï¼šåˆ›å»ºèƒ½åŠ›è¯„ä¼°è¡¨

åœ¨åŒä¸€ä¸ªSQLç¼–è¾‘å™¨ï¼Œåˆ›å»ºæ–°æŸ¥è¯¢ï¼ˆæˆ–æ¸…ç©ºä¸Šä¸€ä¸ªï¼‰ï¼Œå¤åˆ¶ä»¥ä¸‹SQLï¼š

```sql
-- ============================================
-- åˆ›å»ºèƒ½åŠ›è¯„ä¼°è¡¨ (competency_assessments)
-- ============================================

CREATE TABLE IF NOT EXISTS public.competency_assessments (
    id BIGSERIAL PRIMARY KEY,
    engineer_id VARCHAR(50) NOT NULL,
    engineer_name TEXT NOT NULL,
    department TEXT NOT NULL,
    competency_id BIGINT,
    module_name TEXT NOT NULL,
    competency_type TEXT NOT NULL,
    current_score SMALLINT NOT NULL CHECK (current_score >= 1 AND current_score <= 5),
    target_score SMALLINT NOT NULL CHECK (target_score >= 1 AND target_score <= 5),
    gap SMALLINT GENERATED ALWAYS AS (target_score - current_score) STORED,
    assessment_year INTEGER NOT NULL,
    assessment_date DATE DEFAULT CURRENT_DATE,
    notes TEXT,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),
    
    -- å¤–é”®çº¦æŸï¼ˆå¯é€‰ï¼Œå¦‚æœä¸éœ€è¦å¼ºå…³è”å¯ä»¥å»æ‰ï¼‰
    CONSTRAINT fk_competency_id 
        FOREIGN KEY (competency_id) 
        REFERENCES public.competency_definitions(id) 
        ON DELETE SET NULL,
    
    -- çº¦æŸï¼šç›®æ ‡å¾—åˆ†å¿…é¡»å¤§äºç­‰äºç°çŠ¶å¾—åˆ†
    CONSTRAINT check_target_gte_current 
        CHECK (target_score >= current_score)
);

-- æ·»åŠ æ³¨é‡Š
COMMENT ON TABLE public.competency_assessments IS 'èƒ½åŠ›è¯„ä¼°è¡¨ - å­˜å‚¨å·¥ç¨‹å¸ˆçš„èƒ½åŠ›è¯„ä¼°æ•°æ®';
COMMENT ON COLUMN public.competency_assessments.engineer_id IS 'å·¥ç¨‹å¸ˆå·¥å·æˆ–å”¯ä¸€ID';
COMMENT ON COLUMN public.competency_assessments.current_score IS 'ç°çŠ¶å¾—åˆ† (1-5): 1=Know it, 2=Do it, 3=Lead it, 4=Shape it, 5=Master';
COMMENT ON COLUMN public.competency_assessments.target_score IS 'ç›®æ ‡å¾—åˆ† (1-5)ï¼Œå¿…é¡» >= current_score';
COMMENT ON COLUMN public.competency_assessments.gap IS 'èƒ½åŠ›å·®è·ï¼Œè‡ªåŠ¨è®¡ç®— = target_score - current_score';

-- åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_competency_assessments_engineer_id ON public.competency_assessments(engineer_id);
CREATE INDEX idx_competency_assessments_engineer_name ON public.competency_assessments(engineer_name);
CREATE INDEX idx_competency_assessments_department ON public.competency_assessments(department);
CREATE INDEX idx_competency_assessments_module_name ON public.competency_assessments(module_name);
CREATE INDEX idx_competency_assessments_assessment_year ON public.competency_assessments(assessment_year);

-- åˆ›å»ºæ›´æ–°æ—¶é—´çš„è‡ªåŠ¨è§¦å‘å™¨
CREATE TRIGGER update_competency_assessments_updated_at 
    BEFORE UPDATE ON public.competency_assessments 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

**æ“ä½œ**ï¼š
- ç‚¹å‡» **"Run"** æŒ‰é’®
- çœ‹åˆ°æˆåŠŸæç¤º

#### æ­¥éª¤4ï¼šæ’å…¥ç¤ºä¾‹æ•°æ®ï¼ˆå¯é€‰ï¼‰

æ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®ä»¥éªŒè¯è¡¨ç»“æ„ï¼š

```sql
-- ============================================
-- æ’å…¥ç¤ºä¾‹æ•°æ® - èƒ½åŠ›å®šä¹‰è¡¨
-- ============================================

INSERT INTO public.competency_definitions (module_id, module_name, competency_type, competency_code, owner_engineer, is_key_competency) 
VALUES 
    (1, 'TPMåŸºç¡€', 'TPMå…«å¤§æ”¯æŸ±', 'TPM-001', 'Zhang Wei', true),
    (1, 'TPMåŸºç¡€', 'OEEè®¡ç®—ä¸åˆ†æ', 'TPM-002', 'Li Na', true),
    (1, 'TPMåŸºç¡€', 'è‡ªä¸»ä¿å…¨ä½“ç³»', 'TPM-003', 'Chen Ming', false),
    (2, 'ç²¾ç›Šæµç¨‹', 'ä»·å€¼æµåˆ†æ', 'LEAN-001', 'Wang Pei', true),
    (2, 'ç²¾ç›Šæµç¨‹', 'æµç¨‹æ˜ å°„æŠ€æœ¯', 'LEAN-002', 'Liu Yang', false),
    (3, 'é—®é¢˜è§£å†³', '8Dé—®é¢˜è§£å†³', 'PS-001', 'Zhao Jun', true),
    (3, 'é—®é¢˜è§£å†³', 'æ ¹å› åˆ†ææ–¹æ³•', 'PS-002', 'Zhou Li', true),
    (4, 'é¡¹ç›®ç®¡ç†', 'é¡¹ç›®è®¡åˆ’ç¼–åˆ¶', 'PM-001', 'Wu Gang', false),
    (5, 'æ•°æ®åˆ†æ', 'ç»Ÿè®¡è¿‡ç¨‹æ§åˆ¶', 'DA-001', 'Sun Yan', true);

-- ============================================
-- æ’å…¥ç¤ºä¾‹æ•°æ® - èƒ½åŠ›è¯„ä¼°è¡¨
-- ============================================

INSERT INTO public.competency_assessments 
    (engineer_id, engineer_name, department, module_name, competency_type, current_score, target_score, assessment_year) 
VALUES 
    ('ENG001', 'Zhang Wei', 'Quality Team', 'TPMåŸºç¡€', 'TPMå…«å¤§æ”¯æŸ±', 2, 4, 2025),
    ('ENG001', 'Zhang Wei', 'Quality Team', 'TPMåŸºç¡€', 'OEEè®¡ç®—ä¸åˆ†æ', 3, 4, 2025),
    ('ENG001', 'Zhang Wei', 'Quality Team', 'ç²¾ç›Šæµç¨‹', 'ä»·å€¼æµåˆ†æ', 3, 4, 2025),
    ('ENG001', 'Zhang Wei', 'Quality Team', 'é—®é¢˜è§£å†³', '8Dé—®é¢˜è§£å†³', 4, 5, 2025),
    
    ('ENG002', 'Li Na', 'Process Engineering', 'TPMåŸºç¡€', 'TPMå…«å¤§æ”¯æŸ±', 3, 5, 2025),
    ('ENG002', 'Li Na', 'Process Engineering', 'ç²¾ç›Šæµç¨‹', 'ä»·å€¼æµåˆ†æ', 4, 5, 2025),
    ('ENG002', 'Li Na', 'Process Engineering', 'é¡¹ç›®ç®¡ç†', 'é¡¹ç›®è®¡åˆ’ç¼–åˆ¶', 3, 4, 2025),
    
    ('ENG003', 'Chen Ming', 'TPM Center', 'TPMåŸºç¡€', 'è‡ªä¸»ä¿å…¨ä½“ç³»', 2, 4, 2025),
    ('ENG003', 'Chen Ming', 'TPM Center', 'TPMåŸºç¡€', 'OEEè®¡ç®—ä¸åˆ†æ', 2, 3, 2025),
    ('ENG003', 'Chen Ming', 'TPM Center', 'æ•°æ®åˆ†æ', 'ç»Ÿè®¡è¿‡ç¨‹æ§åˆ¶', 3, 5, 2025);
```

---

### æ–¹æ³•2ï¼šä½¿ç”¨å¯è§†åŒ–ç•Œé¢ï¼ˆTable Editorï¼‰

å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰SQLï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Supabaseçš„å¯è§†åŒ–ç•Œé¢ï¼š

#### æ­¥éª¤1ï¼šæ‰“å¼€Table Editor

1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **"Table Editor"**
2. ç‚¹å‡» **"Create a new table"**

#### æ­¥éª¤2ï¼šåˆ›å»ºèƒ½åŠ›å®šä¹‰è¡¨

1. **å¡«å†™è¡¨ä¿¡æ¯**ï¼š
   - Table name: `competency_definitions`
   - Description: èƒ½åŠ›å®šä¹‰è¡¨
   - å‹¾é€‰ "Enable Row Level Security (RLS)" ï¼ˆç¨åé…ç½®ï¼‰

2. **æ·»åŠ åˆ—ï¼ˆColumnsï¼‰**ï¼š
   
   ç‚¹å‡» "Add column"ï¼Œä¾æ¬¡æ·»åŠ ä»¥ä¸‹åˆ—ï¼š
   
   | åˆ—å | ç±»å‹ | é»˜è®¤å€¼ | å¯ç©º | å¤‡æ³¨ |
   |-----|------|--------|-----|------|
   | id | int8 | AUTO | NO | Primary Keyï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰ |
   | module_id | int4 | - | NO | - |
   | module_name | text | - | NO | - |
   | competency_type | text | - | NO | - |
   | competency_code | varchar | - | YES | Unique constraint |
   | description | text | - | YES | - |
   | owner_engineer | text | - | YES | - |
   | is_key_competency | bool | false | NO | - |
   | created_at | timestamptz | now() | NO | - |
   | updated_at | timestamptz | now() | NO | - |

3. **ç‚¹å‡» "Save"**

#### æ­¥éª¤3ï¼šåˆ›å»ºèƒ½åŠ›è¯„ä¼°è¡¨

é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œåˆ›å»º `competency_assessments` è¡¨ï¼Œæ·»åŠ ç›¸åº”çš„åˆ—ã€‚

**æ³¨æ„**ï¼šå¯è§†åŒ–ç•Œé¢åˆ›å»ºå¤–é”®å’Œçº¦æŸè¾ƒå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨SQLæ–¹å¼ã€‚

---

## é…ç½®è®¿é—®æƒé™

### æ­¥éª¤1ï¼šäº†è§£Row Level Security (RLS)

Supabaseé»˜è®¤å¯ç”¨RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ï¼Œè¿™æ„å‘³ç€ï¼š
- æœªæˆæƒçš„ç”¨æˆ·æ— æ³•è®¿é—®æ•°æ®
- éœ€è¦åˆ›å»ºç­–ç•¥ï¼ˆPolicyï¼‰æ¥å…è®¸è®¿é—®

å¯¹äº**è°ƒè¯•å’Œå¼€å‘é˜¶æ®µ**ï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶ç¦ç”¨RLSæˆ–åˆ›å»ºå…è®¸æ‰€æœ‰æ“ä½œçš„ç­–ç•¥ã€‚

### æ­¥éª¤2ï¼šç¦ç”¨RLSï¼ˆä»…ç”¨äºå¼€å‘ï¼‰

**æ–¹æ³•Aï¼šé€šè¿‡SQL**

```sql
-- ç¦ç”¨RLSï¼ˆä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼‰
ALTER TABLE public.competency_definitions DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.competency_assessments DISABLE ROW LEVEL SECURITY;
```

**æ–¹æ³•Bï¼šé€šè¿‡ç•Œé¢**

1. è¿›å…¥ **"Authentication" â†’ "Policies"**
2. æ‰¾åˆ°å¯¹åº”çš„è¡¨
3. ç‚¹å‡»è¡¨åæ—çš„è®¾ç½®å›¾æ ‡
4. å…³é—­ "Enable RLS"

### æ­¥éª¤3ï¼šåˆ›å»ºè®¿é—®ç­–ç•¥ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

å¦‚æœè¦ä¿æŒRLSå¼€å¯ï¼Œåˆ›å»ºå…è®¸æ‰€æœ‰æ“ä½œçš„ç­–ç•¥ï¼š

```sql
-- å…è®¸æ‰€æœ‰ç”¨æˆ·è¯»å–èƒ½åŠ›å®šä¹‰è¡¨
CREATE POLICY "Allow public read access on competency_definitions"
ON public.competency_definitions
FOR SELECT
TO public
USING (true);

-- å…è®¸æ‰€æœ‰ç”¨æˆ·å†™å…¥èƒ½åŠ›å®šä¹‰è¡¨
CREATE POLICY "Allow public write access on competency_definitions"
ON public.competency_definitions
FOR ALL
TO public
USING (true);

-- å…è®¸æ‰€æœ‰ç”¨æˆ·è¯»å–èƒ½åŠ›è¯„ä¼°è¡¨
CREATE POLICY "Allow public read access on competency_assessments"
ON public.competency_assessments
FOR SELECT
TO public
USING (true);

-- å…è®¸æ‰€æœ‰ç”¨æˆ·å†™å…¥èƒ½åŠ›è¯„ä¼°è¡¨
CREATE POLICY "Allow public write access on competency_assessments"
ON public.competency_assessments
FOR ALL
TO public
USING (true);
```

### æ­¥éª¤4ï¼šè·å–APIå¯†é’¥

1. è¿›å…¥ **"Settings" â†’ "API"**
2. æ‚¨ä¼šçœ‹åˆ°ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼š
   - **Project URL**ï¼šä¾‹å¦‚ `https://xxxxx.supabase.co`
   - **anon public key**ï¼šå…¬å¼€å¯†é’¥ï¼ˆç”¨äºå‰ç«¯ï¼‰
   - **service_role key**ï¼šæœåŠ¡å¯†é’¥ï¼ˆç”¨äºåç«¯ï¼Œæƒé™æ›´é«˜ï¼‰

**âš ï¸ é‡è¦**ï¼š
- `anon public key` å¯ä»¥æ”¾åœ¨å‰ç«¯ä»£ç ä¸­
- `service_role key` ç»å¯¹ä¸èƒ½æš´éœ²ï¼Œåªèƒ½åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨
- å°†è¿™äº›å¯†é’¥ä¿å­˜åœ¨ `.env` æ–‡ä»¶ä¸­

---

## æµ‹è¯•æ•°æ®åº“è¿æ¥

### æ–¹æ³•1ï¼šä½¿ç”¨Supabaseå†…ç½®æŸ¥è¯¢

1. è¿›å…¥ **"Table Editor"**
2. ç‚¹å‡»è¡¨å `competency_definitions`
3. æ‚¨åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰æ’å…¥çš„ç¤ºä¾‹æ•°æ®
4. ç‚¹å‡» "Insert row" å¯ä»¥æ‰‹åŠ¨æ·»åŠ æ•°æ®
5. ç‚¹å‡»ä»»æ„è¡Œå¯ä»¥ç¼–è¾‘æˆ–åˆ é™¤

### æ–¹æ³•2ï¼šä½¿ç”¨SQLæŸ¥è¯¢

åœ¨ **SQL Editor** ä¸­è¿è¡Œï¼š

```sql
-- æŸ¥è¯¢æ‰€æœ‰èƒ½åŠ›å®šä¹‰
SELECT * FROM public.competency_definitions;

-- æŸ¥è¯¢æ‰€æœ‰èƒ½åŠ›è¯„ä¼°
SELECT * FROM public.competency_assessments;

-- æŸ¥è¯¢ç‰¹å®šå·¥ç¨‹å¸ˆçš„èƒ½åŠ›è¯„ä¼°
SELECT 
    engineer_name,
    department,
    module_name,
    competency_type,
    current_score,
    target_score,
    gap
FROM public.competency_assessments
WHERE engineer_name = 'Zhang Wei'
ORDER BY module_name, competency_type;

-- ç»Ÿè®¡å„éƒ¨é—¨çš„å¹³å‡èƒ½åŠ›å·®è·
SELECT 
    department,
    COUNT(*) as total_assessments,
    AVG(current_score)::numeric(3,1) as avg_current,
    AVG(target_score)::numeric(3,1) as avg_target,
    AVG(gap)::numeric(3,1) as avg_gap
FROM public.competency_assessments
GROUP BY department
ORDER BY avg_gap DESC;
```

### æ–¹æ³•3ï¼šä½¿ç”¨Supabaseå®¢æˆ·ç«¯ï¼ˆå‡†å¤‡ä»£ç æµ‹è¯•æ—¶ï¼‰

åç»­åœ¨ä»£ç ä¸­æµ‹è¯•è¿æ¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š

```javascript
// è¿™åªæ˜¯ç¤ºä¾‹ï¼Œç°åœ¨ä¸éœ€è¦è¿è¡Œ
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  'YOUR_PROJECT_URL',
  'YOUR_ANON_KEY'
)

// æµ‹è¯•æŸ¥è¯¢
const { data, error } = await supabase
  .from('competency_definitions')
  .select('*')
  
console.log('æ•°æ®:', data)
console.log('é”™è¯¯:', error)
```

---

## åæœŸè¿ç§»åˆ°SQL Server

### æ•°æ®å¯¼å‡º

#### æ–¹æ³•1ï¼šä½¿ç”¨Supabaseå¯¼å‡ºåŠŸèƒ½

1. è¿›å…¥ **"Database" â†’ "Backups"**
2. ç‚¹å‡» **"Download backup"**
3. ä¼šä¸‹è½½ä¸€ä¸ª `.sql` æ–‡ä»¶

#### æ–¹æ³•2ï¼šä½¿ç”¨pg_dumpï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨å®‰è£…äº†PostgreSQLå®¢æˆ·ç«¯ï¼š

```bash
pg_dump -h db.xxxxx.supabase.co -U postgres -d postgres -t competency_definitions -t competency_assessments --data-only > data_export.sql
```

#### æ–¹æ³•3ï¼šå¯¼å‡ºä¸ºCSV

åœ¨SQL Editorä¸­è¿è¡Œï¼š

```sql
-- å¯¼å‡ºèƒ½åŠ›å®šä¹‰è¡¨ï¼ˆå¤åˆ¶ç»“æœç²˜è´´åˆ°Excelï¼‰
COPY (SELECT * FROM public.competency_definitions) TO STDOUT WITH CSV HEADER;

-- å¯¼å‡ºèƒ½åŠ›è¯„ä¼°è¡¨
COPY (SELECT * FROM public.competency_assessments) TO STDOUT WITH CSV HEADER;
```

æˆ–ä½¿ç”¨Table Editorçš„å¯¼å‡ºåŠŸèƒ½ï¼š
- ç‚¹å‡»è¡¨å
- ç‚¹å‡»å³ä¸Šè§’çš„ "..." èœå•
- é€‰æ‹© "Export to CSV"

### SQL Serverè¿ç§»æ˜ å°„

| PostgreSQLç±»å‹ | SQL Serverç±»å‹ | è¯´æ˜ |
|----------------|----------------|------|
| `BIGSERIAL` | `BIGINT IDENTITY(1,1)` | è‡ªå¢ä¸»é”® |
| `TEXT` | `NVARCHAR(MAX)` | æ–‡æœ¬ |
| `VARCHAR(n)` | `NVARCHAR(n)` | å¯å˜é•¿åº¦å­—ç¬¦ä¸² |
| `SMALLINT` | `SMALLINT` | å°æ•´æ•° |
| `INTEGER` | `INT` | æ•´æ•° |
| `BOOLEAN` | `BIT` | å¸ƒå°”å€¼ |
| `TIMESTAMPTZ` | `DATETIMEOFFSET` | å¸¦æ—¶åŒºçš„æ—¶é—´æˆ³ |
| `DATE` | `DATE` | æ—¥æœŸ |

### SQL Serverè¡¨åˆ›å»ºç¤ºä¾‹

```sql
-- SQL Serverç‰ˆæœ¬çš„èƒ½åŠ›å®šä¹‰è¡¨
CREATE TABLE competency_definitions (
    id BIGINT IDENTITY(1,1) PRIMARY KEY,
    module_id INT NOT NULL,
    module_name NVARCHAR(MAX) NOT NULL,
    competency_type NVARCHAR(MAX) NOT NULL,
    competency_code NVARCHAR(50) UNIQUE,
    description NVARCHAR(MAX),
    owner_engineer NVARCHAR(MAX),
    is_key_competency BIT DEFAULT 0,
    created_at DATETIMEOFFSET DEFAULT GETDATE(),
    updated_at DATETIMEOFFSET DEFAULT GETDATE()
);

-- SQL Serverç‰ˆæœ¬çš„èƒ½åŠ›è¯„ä¼°è¡¨
CREATE TABLE competency_assessments (
    id BIGINT IDENTITY(1,1) PRIMARY KEY,
    engineer_id NVARCHAR(50) NOT NULL,
    engineer_name NVARCHAR(MAX) NOT NULL,
    department NVARCHAR(MAX) NOT NULL,
    competency_id BIGINT,
    module_name NVARCHAR(MAX) NOT NULL,
    competency_type NVARCHAR(MAX) NOT NULL,
    current_score SMALLINT NOT NULL CHECK (current_score >= 1 AND current_score <= 5),
    target_score SMALLINT NOT NULL CHECK (target_score >= 1 AND target_score <= 5),
    gap AS (target_score - current_score) PERSISTED,
    assessment_year INT NOT NULL,
    assessment_date DATE DEFAULT GETDATE(),
    notes NVARCHAR(MAX),
    created_at DATETIMEOFFSET DEFAULT GETDATE(),
    updated_at DATETIMEOFFSET DEFAULT GETDATE(),
    
    CONSTRAINT fk_competency_id FOREIGN KEY (competency_id) 
        REFERENCES competency_definitions(id) ON DELETE SET NULL,
    CONSTRAINT check_target_gte_current CHECK (target_score >= current_score)
);
```

---

## å¸¸è§é—®é¢˜ FAQ

### Q1: Supabaseå…è´¹å¥—é¤å¤Ÿç”¨å—ï¼Ÿ
**A**: å¯¹äºè°ƒè¯•å’Œå¼€å‘ï¼Œå…è´¹å¥—é¤å®Œå…¨å¤Ÿç”¨ï¼š
- 500MBæ•°æ®åº“å­˜å‚¨
- 50,000æ¬¡APIè¯·æ±‚/æœˆ
- 2GBæ–‡ä»¶å­˜å‚¨
- 50MBæ–‡ä»¶ä¸Šä¼ é™åˆ¶

### Q2: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ
**A**: 
1. è¿›å…¥ "Database" â†’ "Tables"
2. ç‚¹å‡»è¡¨åæ—çš„ "..." èœå•
3. é€‰æ‹© "Truncate table"ï¼ˆæ¸…ç©ºæ•°æ®ï¼‰æˆ– "Delete table"ï¼ˆåˆ é™¤è¡¨ï¼‰

### Q3: å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ•°ï¼Ÿ
**A**: 
è¿›å…¥ "Database" â†’ "Connection Pooling"ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰è¿æ¥æ•°å’Œé…ç½®

### Q4: å¿˜è®°æ•°æ®åº“å¯†ç æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. è¿›å…¥ "Settings" â†’ "Database"
2. ç‚¹å‡» "Reset database password"
3. è¾“å…¥æ–°å¯†ç å¹¶ä¿å­˜

### Q5: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ
**A**: 
- å…è´¹å¥—é¤ï¼šæ¯å¤©è‡ªåŠ¨å¤‡ä»½ï¼Œä¿ç•™7å¤©
- ä»˜è´¹å¥—é¤ï¼šå¯è‡ªå®šä¹‰å¤‡ä»½ç­–ç•¥

### Q6: èƒ½å¦ç›´æ¥è¿æ¥PostgreSQLå®¢æˆ·ç«¯ï¼Ÿ
**A**: 
å¯ä»¥ï¼åœ¨ "Settings" â†’ "Database" æ‰¾åˆ°è¿æ¥å­—ç¬¦ä¸²ï¼š
```
Host: db.xxxxx.supabase.co
Port: 5432
Database: postgres
User: postgres
Password: [æ‚¨çš„å¯†ç ]
```

---

## ä¸‹ä¸€æ­¥æ“ä½œå»ºè®®

å®ŒæˆSupabaseé…ç½®åï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… **éªŒè¯è¡¨ç»“æ„**ï¼šåœ¨Table Editorä¸­æŸ¥çœ‹è¡¨å’Œæ•°æ®
2. âœ… **æµ‹è¯•SQLæŸ¥è¯¢**ï¼šåœ¨SQL Editorä¸­è¿è¡Œå„ç§æŸ¥è¯¢
3. âœ… **å¯¼å…¥çœŸå®æ•°æ®**ï¼šå°†æ‚¨çš„Excelæ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“
4. âœ… **é›†æˆåˆ°åº”ç”¨**ï¼šåœ¨Reactåº”ç”¨ä¸­è¿æ¥Supabase
5. âœ… **é…ç½®ç¯å¢ƒå˜é‡**ï¼šå°†APIå¯†é’¥ä¿å­˜åˆ° `.env` æ–‡ä»¶

---

## ç›¸å…³èµ„æº

- ğŸ“š [Supabaseå®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- ğŸ“ [Supabase JavaScriptå®¢æˆ·ç«¯æ–‡æ¡£](https://supabase.com/docs/reference/javascript/introduction)
- ğŸ”§ [PostgreSQLå®˜æ–¹æ–‡æ¡£](https://www.postgresql.org/docs/)
- ğŸ¬ [Supabaseè§†é¢‘æ•™ç¨‹](https://www.youtube.com/c/Supabase)

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ**

æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸåˆ›å»ºSupabaseæ•°æ®åº“å¹¶å»ºç«‹ä¸¤å¼ è¡¨ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼

å®Œæˆé…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç¼–å†™ä»£ç å°†æ‚¨çš„åº”ç”¨è¿æ¥åˆ°Supabaseæ•°æ®åº“ã€‚ ğŸš€
